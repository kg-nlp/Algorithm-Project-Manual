---
sort: 2
---



# æ¡†æ¶ç¯å¢ƒ



* [ç®—æ³•å¼€å‘æ‰‹å†Œ](https://kg-nlp.github.io/Algorithm-Project-Manual/ç®—æ³•æ¡†æ¶/æ¡†æ¶ç¯å¢ƒ)

* [ä¸ªäººçŸ¥ä¹](https://zhihu.com/people/zhangyj-n)



## Pytorch

[pytorch-docker](https://github.com/cnstark/pytorch-docker)

### pytorch 1.7.0

> ç®—æ³•æ¡†æ¶çš„åŸºç¡€é•œåƒ

> è¿™ä¸ªç‰ˆæœ¬çš„cudaæ— æ³•æ»¡è¶³A800çš„æ˜¾å¡ä½¿ç”¨è¦æ±‚

```bash
docker run -it -d --name pytorch_env -p 8085:22 -p 8040:8040 -p 8030:8030 -p 8020:8020 --gpus all --shm-size 64g --restart=always pytorch/pytorch:1.7.0-cuda11.0-cudnn8-devel /bin/bash

apt-get update
apt-get install -y vim
apt-get install -y openssh-server
service ssh restart
root@b9d22b100490:/opt/conda/bin# ln -s /opt/conda/bin/python /usr/local/bin/python
root@b9d22b100490:/opt/conda/bin# ln -s /opt/conda/bin/pip /usr/local/bin/pip
```

> è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶è‡ªåŠ¨å¼€å¯sshæœåŠ¡

```bash
# æ‰¾åˆ°å¹¶æ‰“å¼€æ–‡ä»¶/root/.bashrc
$ vim /root/.bashrc
# åœ¨.bashrcæœ«å°¾æ·»åŠ å¦‚ä¸‹ä»£ç 
$ service ssh start
```

> é‡æ–°commit ä»¥åŠå¯åŠ¨,å¯åŠ¨æ—¶æ³¨æ„å¤–æŒ‚æ•°æ®å·,ä»¥åŠå¤šæš´éœ²ç«¯å£

```bash
docker commit pytorch_env registry.cn-beijing.aliyuncs.com/zhangyj-n/pytorch:1.7.0-cuda11.0-cudnn8-devel

docker run -it -d --name pytorch_env -p 8085:22  -p 8086:8086 -p 8087:8087 -p 8088:8088 -p 8089:8089 -p 8084:8084 \
-v /home/zhangyj/Algorithm_Frame:/home/Algorithm_Frame \
--shm-size 64g --restart=always --gpus all  -e NVIDIA_VISIBLE_DEVICES=all registry.cn-beijing.aliyuncs.com/zhangyj-n/pytorch:1.7.0-cuda11.0-cudnn8-devel /bin/bash
```



>  å¦‚æœç¼ºå°‘åŠ¨æ€åº“,å‚è€ƒå·¥ç¨‹å†…å®¹ [ğŸ”¨å¼€å‘é—®é¢˜](https://kg-nlp.github.io/Algorithm-Project-Manual/å·¥ç¨‹å†…å®¹/å¼€å‘é—®é¢˜.html)

```bash
ç¤ºä¾‹:
find / -name libcudart.so.10.2
/usr/local/cuda-10.2/targets/x86_64-linux/lib/libcudart.so.10.2
æ‹·è´è‡³ /usr/lib/ 
```



### pytorch 1.13.0

* smpæ¯”èµ›é•œåƒåˆ¶ä½œ,customç¯å¢ƒ

```bash
åŸºäºä¸Šé¢1.7.0å¼€å‘,c++ç‰ˆæœ¬è¿˜æ˜¯æœ‰äº›ä½äº†
registry.cn-beijing.aliyuncs.com/zhangyj-n/pytorch:1.13.0-cuda11.0-cudnn8-simple
docker run -it -d --name smp_env --gpus all  -e NVIDIA_VISIBLE_DEVICES=all registry.cn-beijing.aliyuncs.com/zhangyj-n/pytorch:1.13.0-cuda11.0-cudnn8-simple /bin/bash

docker exec -it smp_env bash  # è¿›å…¥å®¹å™¨
apt-get update
apt-get install -y vim
apt-get install -y openssh-server  # å®‰è£…sshæœåŠ¡
vi /etc/ssh/sshd_config  # ä¿®æ”¹sshé…ç½®æ–‡ä»¶å¦‚ä¸‹(å…¨éƒ¨æ›¿æ¢)
ggdG
"""
ChallengeResponseAuthentication no
UsePAM yes
X11Forwarding yes
PrintMotd no
AcceptEnv LANG LC_*
Subsystem    sftp    /usr/lib/openssh/sftp-server
PubkeyAuthentication yes
RSAAuthentication yes
PermitRootLogin yes
"""

service ssh restart  # å¯åŠ¨
passwd root  # ä¿®æ”¹å¯†ç 
root
cat /etc/passwd

root@b9d22b100490:/opt/conda/bin# ln -s /opt/conda/bin/python /usr/local/bin/python
root@b9d22b100490:/opt/conda/bin# ln -s /opt/conda/bin/pip /usr/local/bin/pip

which python  # æŸ¥æ‰¾pythonè§£æå™¨è·¯å¾„,ä½¿ç”¨pycharmè¿œç¨‹è¿æ¥æ—¶éœ€è¦

apt-get install curl -y
apt-get install zip -y
apt-get install unzip -y
```

> è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶è‡ªåŠ¨å¼€å¯sshæœåŠ¡
```bash
# æ‰¾åˆ°å¹¶æ‰“å¼€æ–‡ä»¶/root/.bashrc
$ vim /root/.bashrc
# åœ¨.bashrcæœ«å°¾æ·»åŠ å¦‚ä¸‹ä»£ç 
$ service ssh start
```

>  ç”Ÿæˆæ–°é•œåƒ

```bash
docker commit -m 'update' registry.cn-beijing.aliyuncs.com/zhangyj-n/pytorch:1.13.0-cuda11.0-cudnn8-0823
```



> å·²å®‰è£…pip

```tex
transformers==4.31.0
modelscope==1.8.3
numpy==1.20.3
sentencepiece
torch==1.13.0
accelerate==0.21.0

python-docx==0.8.11
fastapi==0.101.1
openpyxl==3.1.2

elasticsearch==7.10.1
pymilvus==1.1.2
faiss-gpu==1.7.2
pdfplumber==0.10.2
pandas==2.0.3
```



> å¯åŠ¨

```bash
docker run -it -d --name custom_env \
-p 8015:22  -p 8001:8001 -p 8002:8002 -p 8003:8003 -p 8004:8004 -p 8005:8005 \
-v /data/zhangyj/custom_project:/workspace/custom_project \
--gpus all --shm-size 64g --restart=always \
-e NVIDIA_VISIBLE_DEVICES=all \
registry.cn-beijing.aliyuncs.com/zhangyj-n/pytorch:1.13.0-cuda11.0-cudnn8-0823 /bin/bash
```



* åœ¨pytorchç¯å¢ƒä¸­å®‰è£…paddleåå†ä½¿ç”¨visualdlå¯è§†åŒ–æ—¥å¿—

```bash
which visualdl
find / -name visualdl

# åˆ›å»ºè½¯é“¾æ¥
ln -s /opt/conda/bin/visualdl /usr/local/bin/visualdl 

# æ­£å¸¸å¯åŠ¨æ–¹å¼
/opt/conda/bin/visualdl --logdir=/home/Algorithm_Frame/LLM/ernie-1.0/output/ernie-3.0-micro-zh/runs/ --host= 0.0.0.0 --port=8010   æ‰“ä¸å¼€è¯•è¯•ä¸‹é¢

# ä¸Šè¿°æ— æ³•æ‰“å¼€,ç›´æ¥è¿è¡Œlogæ–‡ä»¶
visualdl service upload --logdir ./runs/

# streamlitå‰ç«¯
ln -s /opt/conda/bin/streamlit /usr/local/bin/streamlit
```









## Paddle

### paddle:2.4.1

åœ¨A800æ— æ³•è¿è¡Œ,cudaä¸å…¼å®¹

```bash
docker run -it -d --name paddle_env -p 8075:22 -v /home/zhangyj/EngineeringField/CDE:/home/EngineeringField/CDE --gpus all --shm-size 64g --restart=always -e NVIDIA_DRIVER_CAPABILITIES=compute,utility -e NVIDIA_VISIBLE_DEVICES=all paddlepaddle/paddle:2.4.1-gpu-cuda10.2-cudnn7.6-trt7.0 /bin/bash


è¿œç¨‹è®¿é—® æŸ¥çœ‹ ä¸Šè¿°é“¾æ¥ï¼ˆé‡ç‚¹ï¼‰
docker exec -it paddle_env bash
apt-get install openssh-server
service ssh restart

# å¦‚æœæ²¡æœ‰é…ç½®rootå¯†ç æ—¶éœ€è¦è¿›è¡Œçš„æ“ä½œ
passwd root
root
cat /etc/passwd

pip install paddle_serving_app paddle_serving_client
pip install paddle-serving-server-gpu==0.8.3.post102 -i https://pypi.tuna.tsinghua.edu.cn/simple

which visualdl
find / -name visualdl
ln -s /usr/local/python3.7.0/bin/visualdl /usr/local/bin/visuadl
visualdl --logdir=./runs/ --port=8040

docker commit paddle_env registry.cn-beijing.aliyuncs.com/zhangyj-n/paddle:2.4.1-gpu-cuda10.2-cudnn7.6-trt7.0-20230223

docker run -it -d --name paddle_env_20230223 -p 8075:22 -p 8071:8071 -p 8072:8072 -p 8073:8073 -p 8874:8874 -v /home/zhangyj/EngineeringField/CDE:/home/EngineeringField/CDE --gpus all --shm-size 64g --restart=always -e NVIDIA_DRIVER_CAPABILITIES=compute,utility -e NVIDIA_VISIBLE_DEVICES=all registry.cn-beijing.aliyuncs.com/zhangyj-n/paddle:2.4.1-gpu-cuda10.2-cudnn7.6-trt7.0-20230223
```



### paddle:2.5.0



```bash
docker run -it -d --name paddle_env -p 8075:22 -p 18040:18040 -p 18030:18030 -p 18020:18020 -p 18010:18010  -v /data/zhangyj/CDE:/home/zhangyj/CDE --gpus all --shm-size 64g --restart=always -e NVIDIA_DRIVER_CAPABILITIES=compute,utility -e NVIDIA_VISIBLE_DEVICES=all paddlepaddle/paddle:2.5.0-gpu-cuda11.7-cudnn8.4-trt8.4 /bin/bash

åˆ‡æ¢é˜¿é‡Œæº 
apt-get update

è¿œç¨‹è®¿é—® æŸ¥çœ‹ ä¸Šè¿°é“¾æ¥ï¼ˆé‡ç‚¹ï¼‰
docker exec -it paddle_env bash
apt-get install -y openssh-server
service ssh restart

# å¦‚æœæ²¡æœ‰é…ç½®rootå¯†ç æ—¶éœ€è¦è¿›è¡Œçš„æ“ä½œ
passwd root
root
cat /etc/passwd

pip install paddle_serving_app paddle_serving_client
pip install paddle-serving-server-gpu==0.8.3.post112 -i https://pypi.tuna.tsinghua.edu.cn/simple

which visualdl
find / -name visualdl

ln -s /usr/local/python3.7.0/bin/visualdl /usr/local/bin/visuadl
visualdl --logdir=./runs/ --port=8040

vim /root/.bashrc
service ssh start


docker commit paddle_env registry.cn-beijing.aliyuncs.com/zhangyj-n/paddle:2.5.0-gpu-cuda11.7-cudnn8.4-trt8.4

docker run -it -d --name paddle_env -p 8075:22 -p 8076:8076 -p 8077:8077 -p 8079:8079 -p 8074:8074  -v /data/zhangyj/CDE:/home/zhangyj/CDE --gpus all --shm-size 64g --restart=always -e NVIDIA_DRIVER_CAPABILITIES=compute,utility -e NVIDIA_VISIBLE_DEVICES=all registry.cn-beijing.aliyuncs.com/zhangyj-n/paddle:2.5.0-gpu-cuda11.7-cudnn8.4-trt8.4 /bin/bash
```



## pytorch-paddle

### ==paddle_torch:base-1.13.0-2.4.2-11.7==

```
docker run -it -d --name test_env --gpus all -e NVIDIA_VISIBLE_DEVICES=all cnstark/pytorch:1.13.0-py3.9.12-cuda11.7.1-devel-ubuntu20.04 /bin/bash

docker exec -it test_env bash  # è¿›å…¥å®¹å™¨

pip install pip -U

ubuntuæ›´æ–°æ¸…åæº
vi /etc/apt/sources.list
apt-get update

apt-get install -y vim
apt-get install -y openssh-server  # å®‰è£…sshæœåŠ¡
vi /etc/ssh/sshd_config  # ä¿®æ”¹sshé…ç½®æ–‡ä»¶å¦‚ä¸‹(å…¨éƒ¨æ›¿æ¢)
ggdG
"""
ChallengeResponseAuthentication no
UsePAM yes
X11Forwarding yes
PrintMotd no
AcceptEnv LANG LC_*
Subsystem    sftp    /usr/lib/openssh/sftp-server
PubkeyAuthentication yes
RSAAuthentication yes
PermitRootLogin yes
"""

# æ‰¾åˆ°å¹¶æ‰“å¼€æ–‡ä»¶/root/.bashrc
$ vim /root/.bashrc
# åœ¨.bashrcæœ«å°¾æ·»åŠ å¦‚ä¸‹ä»£ç 
$ service ssh start

service ssh restart  # å¯åŠ¨
passwd root  # ä¿®æ”¹å¯†ç 
root
cat /etc/passwd

which python  # æŸ¥æ‰¾pythonè§£æå™¨è·¯å¾„,ä½¿ç”¨pycharmè¿œç¨‹è¿æ¥æ—¶éœ€è¦

root@b9d22b100490:/opt/conda/bin# ln -s /opt/conda/bin/python /usr/local/bin/python
root@b9d22b100490:/opt/conda/bin# ln -s /opt/conda/bin/pip /usr/local/bin/pip


apt-get install curl -y
apt-get install zip -y
apt-get install unzip -y

æ°¸ä¹…æ›´æ–°æ¸…åæº
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
```



> ubuntuæ›´æ–°é˜¿é‡Œäº‘

```
é˜¿é‡Œæº
deb https://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse

deb https://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse

deb https://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse

# deb https://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse
# deb-src https://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse

deb https://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse


æ¸…åæº
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse multiverse
```



> å®‰è£…å¿…è¦åŒ…

````
transformers==4.31.0
modelscope==1.8.3
numpy==1.20.3
sentencepiece
accelerate==0.21.0
python-docx==0.8.11
fastapi==0.101.1
openpyxl==3.1.2
elasticsearch==7.10.1
pymilvus==1.1.2
faiss-gpu==1.7.2
pdfplumber==0.10.2
pandas==2.0.3
matplotlib==3.7.2
visualdl==2.4.2
paddlenlp==2.5.2
hnswlib==0.7.0

pip install paddlepaddle-gpu==2.4.2.post117 -f https://www.paddlepaddle.org.cn/whl/linux/mkl/avx/stable.html
````



> ç”Ÿæˆæ–°é•œåƒå¹¶æ¨é€,è¿è¡Œ

```
docker commit test_env registry.cn-beijing.aliyuncs.com/zhangyj-n/paddle_torch:base-1.13.0-2.4.2-11.7

docker run -it -d --name paddle_torch_env -p 8075:22 -p 8076:8076 -p 8077:8077 -p 8079:8079 -p 8074:8074  -v /data/zhangyj/CDE:/home/zhangyj/CDE --gpus all --shm-size 64g --restart=always -e NVIDIA_DRIVER_CAPABILITIES=compute,utility -e NVIDIA_VISIBLE_DEVICES=all registry.cn-beijing.aliyuncs.com/zhangyj-n/paddle_torch:base-1.13.0-2.4.2-11.7 /bin/bash

docker run -it -d --name custom_env \
-p 8015:22  -p 8001:8001 -p 8002:8002 -p 8003:8003 -p 8004:8004 -p 8005:8005 \
-v /data/zhangyj/custom_project:/workspace/custom_project \
--gpus all --shm-size 64g --restart=always \
-e NVIDIA_VISIBLE_DEVICES=all \
registry.cn-beijing.aliyuncs.com/zhangyj-n/paddle_torch:base-1.13.0-2.4.2-11.7 /bin/bash
```









## jupyter



[docker-github](https://github.com/jupyter/docker-stacks)

[jupyter-docker-stacks](https://jupyter-docker-stacks.readthedocs.io/en/latest/using/recipes.html?highlight=password#using-sudo-within-a-container)

```bash
docker run -it -d -p 10000:8888 --user root -e GRANT_SUDO=yes --restart=always --name jupyter_data -v "${PWD}":/home/jovyan/work jupyter/datascience-notebook:85f615d5cafa
```



```bash
(base) jovyan@f43a5217f92c:~$ jupyter server list
Currently running servers:
http://24a936b38d1f:8888/?token=53325304204535831905622ab4544174b8be656f96e02ebb :: /home/jovyan

'''ä¸­é—´çœç•¥å‡çº§apt,å®‰è£…å…¶ä»–æœåŠ¡'''

chown -Rf jovyan:users ./
```





## SSHè®¿é—®

> å½“å¯åŠ¨å®¹å™¨å å¤–éƒ¨æ— æ³•è®¿é—®æ—¶

**å®‰è£…ssh**

```
apt-get install -y openssh-server

æ— æ³•å®‰è£…
apt-get update
```

**2.å¤‡ä»½sshçš„é…ç½®æ–‡ä»¶**

```
sudo cp /etc/ssh/sshd_config /etc/ssh/sshd_config.bak
```

**3.æ–°è£…çš„sshéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶**

```
vi /etc/ssh/sshd_config
```

ã€€ã€€é…ç½®æ–‡ä»¶ä¿®æ”¹è¿™å‡ å¤„åœ°æ–¹ã€€

```
ChallengeResponseAuthentication no
UsePAM yes
X11Forwarding yes
PrintMotd no
AcceptEnv LANG LC_*
Subsystem    sftp    /usr/lib/openssh/sftp-server
PubkeyAuthentication yes
RSAAuthentication yes
PermitRootLogin yes
```

**4.å¯åŠ¨ssh**

```
service ssh start            # * Starting OpenBSD Secure Shell server sshd<br># æˆ–è€…<br>/etc/init.d/ssh start        # * Starting OpenBSD Secure Shell server sshd
```

ã€€ã€€å¦‚æœæç¤ºé”™è¯¯ä¿¡æ¯ä¸­åŒ…å«**could not load host key** åˆ™éœ€è¦é‡æ–°ç”Ÿæˆ key

```
sudo rm /etc/ssh/ssh*key # å…ˆç§»é™¤æ—§çš„key dpkg-reconfigure openssh-server
```

ã€€ã€€ç”Ÿæˆä¹‹åéœ€è¦é‡å¯SSHæœåŠ¡ä½¿æ–°çš„å¯†é’¥ç”Ÿæ•ˆï¼š   

```
service ssh restart          # * Restarting OpenBSD Secure Shell server sshd<br># æˆ–è€…/etc/init.d/ssh restart       # * Restarting OpenBSD Secure Shell server sshd
```

ã€€ã€€å¯åŠ¨ã€åœæ­¢å’Œé‡å¯sshçš„å‘½ä»¤å¦‚ä¸‹

```
/etc/init.d/ssh start         # * Starting OpenBSD Secure Shell server sshd /etc/init.d/ssh stop          # * Stopping OpenBSD Secure Shell server sshd /etc/init.d/ssh restart       # * Restarting OpenBSD Secure Shell server sshd
```



**5.æŸ¥çœ‹æœåŠ¡çŠ¶æ€**

```
service ssh status # * sshd is running  æ˜¾ç¤ºæ­¤å†…å®¹åˆ™è¡¨ç¤ºå¯åŠ¨æ­£å¸¸
```

**6.æŸ¥çœ‹sshæ˜¯å¦å¯åŠ¨**

```
ps -e | grep ssh

ã€€ã€€å¦‚æœsshå·²ç»å¯åŠ¨åˆ™ä¼šæç¤º

469 ?        00:00:00 sshd
```

**7.è®¾ç½®sshå¼€æœºè‡ªå¯åŠ¨**

å®¹å™¨å†…è®¾ç½®

```
# æ‰¾åˆ°å¹¶æ‰“å¼€æ–‡ä»¶/root/.bashrc
$ vim /root/.bashrc
# åœ¨.bashrcæœ«å°¾æ·»åŠ å¦‚ä¸‹ä»£ç 
$ service ssh start
```





## **å†…æ ¸ã€nvidiaé©±åŠ¨ã€Cudaã€cudannç‰ˆæœ¬å¯¹åº”å…³ç³»åŠå®‰è£…**

centos :

yumæ›´æ–°-å†…æ ¸å‡çº§-ä¸nvidiaé©±åŠ¨ä¸å…¼å®¹

ä»¥pkm-01ä¸ºä¾‹

**lspci | grep -i nvidia  æŸ¥çœ‹GPU**

```
3b:00.0 3D controller: NVIDIA Corporation TU104GL [Tesla T4] (rev a1)
86:00.0 3D controller: NVIDIA Corporation TU104GL [Tesla T4] (rev a1)
af:00.0 3D controller: NVIDIA Corporation TU104GL [Tesla T4] (rev a1)
d8:00.0 3D controller: NVIDIA Corporation TU104GL [Tesla T4] (rev a1)
```

**uname -m && cat /etc/\*release**  æŸ¥çœ‹ç¯å¢ƒä¿¡æ¯

```
x86_64
CentOS Linux release 7.9.2009 (Core)
NAME="CentOS Linux"
VERSION="7 (Core)"
ID="centos"
ID_LIKE="rhel fedora"
VERSION_ID="7"
PRETTY_NAME="CentOS Linux 7 (Core)"
ANSI_COLOR="0;31"
CPE_NAME="cpe:/o:centos:centos:7"
HOME_URL="https://www.centos.org/"
BUG_REPORT_URL="https://bugs.centos.org/"

CENTOS_MANTISBT_PROJECT="CentOS-7"
CENTOS_MANTISBT_PROJECT_VERSION="7"
REDHAT_SUPPORT_PRODUCT="centos"
REDHAT_SUPPORT_PRODUCT_VERSION="7"

CentOS Linux release 7.9.2009 (Core)
CentOS Linux release 7.9.2009 (Core)
```



**gcc --version**

```
gcc (GCC) 7.3.1 20180303 (Red Hat 7.3.1-5)
Copyright (C) 2017 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE
```



**uname -r**

å†…æ ¸å¤´å’Œå†…æ ¸å¼€å‘åŒ…

```
3.10.0-1160.90.1.el7.x86_64
Note: If you perform a system update which changes the version of the linux kernel being used, make sure to rerun the commands below to ensure you have the correct kernel headers and kernel development packages installed. Otherwise, the CUDA Driver will fail to work with the new kernel.
```

centos å®‰è£…linuxå†…æ ¸å¤´å’Œå†…æ ¸å¼€å‘åŒ…

**cuda toolkit**

```
distribution-specific packages (RPM and Deb packages), 
or a distribution-independent package (runfile packages)
```

å€¾å‘ä½¿ç”¨å‰è€…

```
The libcuda.so library is installed in the /usr/lib{,64}/nvidia directory. For pre-existing projects which use libcuda.so, it may be useful to add a symbolic link from libcuda.so in the /usr/lib{,64} directory.
```

**NVIDIA CUDA Toolkit Release Notes**

[cudaç‰ˆæœ¬å’Œnvidiaå†…æ ¸ç‰ˆæœ¬](https://docs.nvidia.com/cuda/cuda-toolkit-release-notes/index.html)

![image-20230904204839067](æ¡†æ¶ç¯å¢ƒ.assets/image-20230904204839067.png)

```
wget https://developer.download.nvidia.com/compute/cuda/12.1.1/local_installers/cuda-repo-rhel7-12-1-local-12.1.1_530.30.02-1.x86_64.rpm
sudo rpm -i cuda-repo-rhel7-12-1-local-12.1.1_530.30.02-1.x86_64.rpm
sudo yum clean all
sudo yum -y install nvidia-driver-latest-dkms
sudo yum -y install cuda
```



[**cudaé©±åŠ¨**](https://www.nvidia.com/Download/Find.aspx)

![image-20230904204915091](æ¡†æ¶ç¯å¢ƒ.assets/image-20230904204915091.png)



åˆ°å¥½çš„ç¯å¢ƒä¸­æŸ¥çœ‹linuxå†…æ ¸ç‰ˆæœ¬,æŸ¥çœ‹nvidiaé©±åŠ¨ç‰ˆæœ¬,æŸ¥çœ‹cudaç‰ˆæœ¬

[**https://blog.csdn.net/A15216110998/article/details/113402172**](https://blog.csdn.net/A15216110998/article/details/113402172)  **è¿™ä¸ªæ–‡ä»¶ä¸é”™**

æ ¹æ®æ•™ç¨‹

ç¬¬äºŒæ­¥ï¼Œä½¿ç”¨nvcc -Væ£€æŸ¥é©±åŠ¨å’Œcuda

```
nvcc: NVIDIA (R) Cuda compiler driver
Copyright (c) 2005-2021 NVIDIA Corporation
Built on Sun_Feb_14_21:12:58_PST_2021
Cuda compilation tools, release 11.2, V11.2.152
Build cuda_11.2.r11.2/compiler.29618528_0
```

ç¬¬ä¸‰æ­¥ï¼ŒæŸ¥çœ‹å·²å®‰è£…é©±åŠ¨çš„ç‰ˆæœ¬ä¿¡æ¯

```
ls /usr/src | grep nvidia
nvidia-530.30.02
```

docker run gpu æ— æ³•ä½¿ç”¨æ˜¯,è®°å¾—è£…nvidia-container-runtime

```
å®‰è£…NVIDIA-CONTAINER-RUNTIME
åœ¨https://nvidia.github.io/nvidia-container-runtime/æŸ¥çœ‹æ”¯æŒçš„æ“ä½œç³»ç»Ÿå’Œç‰ˆæœ¬ï¼Œå¹¶æ ¹æ®å¯¹åº”é€‰é¡¹ï¼Œæ·»åŠ æºï¼Œå› ä¸ºæˆ‘æ˜¯centos7ï¼Œæ‰€ä»¥æ·»åŠ æ–¹å¼ä¸ºï¼š

distribution=$(. /etc/os-release;echo $ID$VERSION_ID)
curl -s -L https://nvidia.github.io/nvidia-container-runtime/$distribution/nvidia-container-runtime.repo | \
sudo tee /etc/yum.repos.d/nvidia-container-runtime.repo

ç„¶åç›´æ¥yum install å°±å¯ä»¥äº†
sudo yum install nvidia-container-runtime
è¿›è¡Œæµ‹è¯•ï¼Œå¦‚æœèƒ½æˆåŠŸå‡ºç°æ˜¾å¡ä¿¡æ¯å°±å¯ä»¥äº†

sudo systemctl restart docker

docker run -it --rm --gpus all centos nvidia-smi
```

**å®‰è£…å®Œåå†é‡å¯  sudo reboot**



## condaç¯å¢ƒé…ç½®



**Linuxä¸‹å®‰è£…miniconda**

https://blog.csdn.net/m0_46336568/article/details/127836072

```
#ç¬¬ä¸€æ­¥ä¸‹è½½minicondaå®‰è£…åŒ… 
#å®‰è£…åŒ…è¿æ¥https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/ï¼ŒæŸ¥æ‰¾ç›¸åº”å®‰è£…åŒ…
wget -c https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/Miniconda3-py39_4.9.2-Linux-x86_64.sh
#ç¬¬äºŒæ­¥å®‰è£…
bash Miniconda3-py39_4.9.2-Linux-x86_64.sh
#ç¬¬ä¸‰éƒ¨é…ç½®condaé•œåƒ
source ~/.bashrc
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/bioconda
conda config --set show_channel_urls yes
#ç¬¬å››æ­¥åˆ›å»ºä¸€ä¸ªåç§°ä¸ºpython38çš„ç¯å¢ƒï¼Œpythonç‰ˆæœ¬ç­‰äº3.8
conda create -n tf2.3torch1.7 python=3.8
conda create -n paddle_env python=3.8
#ç¬¬äº”æ­¥ æ¿€æ´»ç¯å¢ƒ
source activate python38
```



**åˆ›å»ºç”¨æˆ·å’Œå¯†ç **

```
useradd zhangyj
passwd zhangyj
zhangyj-n  zhangyj-n
æ¥ä¸‹æ¥å®‰è£…pipåŒ…
```



**é…ç½®æº**

```
# è®¾ç½®condaå‘½ä»¤å¯åŠ¨
vi ~/.bashrc
å†…å®¹å¦‚ä¸‹
export PATH=/home/zhangyj/miniconda3/bin/:$PATH


#è®¾ç½®pipæ¸…åæº
#ç”¨æˆ·çš„æ–‡ä»¶å¤¹ä¸‹æ–°å»ºç›®å½•.pipï¼Œå¹¶åœ¨ç›®å½•æ–°å»ºé…ç½®æ–‡ä»¶pip.conf
#å‘½ä»¤
mkdir ~/.pip
cd ~/.pip
vi pip.conf
å†…å®¹å¦‚ä¸‹
[global]
index-url=https://pypi.tuna.tsinghua.edu.cn/simple
[install]
trusted-host=pypi.tuna.tsinghua.edu.cn
disable-pip-version-check = true
timeout = 6000
```



**å¯¼å‡ºè™šæ‹Ÿç¯å¢ƒpipåŒ…**

```
conda install -n env_name python=3.7

pipæ‰¹é‡å¯¼å‡ºåŒ…å«ç¯å¢ƒä¸­æ‰€æœ‰ç»„ä»¶çš„requirements.txtæ–‡ä»¶
pip freeze > requirements.txt

pipæ‰¹é‡å®‰è£…requirements.txtæ–‡ä»¶ä¸­åŒ…å«çš„ç»„ä»¶ä¾èµ–
pip install -r requirements.txt

condaæ‰¹é‡å¯¼å‡ºåŒ…å«ç¯å¢ƒä¸­æ‰€æœ‰ç»„ä»¶çš„requirements.txtæ–‡ä»¶
conda list -e > requirements.txt

condaæ‰¹é‡å®‰è£…requirements.txtæ–‡ä»¶ä¸­åŒ…å«çš„ç»„ä»¶ä¾èµ–
conda install --yes --file requirements.txt
```



## python å®‰è£…



### Python3.7

```
å®‰è£…python & pythonå®‰è£…
centoså®‰è£…python3
1) é¦–å…ˆå®‰è£…ä¾èµ–åŒ…
 yum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel libffi-devel
2) ä¸‹è½½python3å®‰è£…åŒ…
[root@python tools]# wget https://www.python.org/ftp/python/3.7.4/Python-3.7.4.tgz
3) è§£å‹
[root@python tools]# tar xvzf Python-3.7.4.tgz 
tar xvzf Python-3.7.4.tgz
4) åˆ›å»ºæ–‡ä»¶å¤¹æŠŠpython3å®‰è£…åœ¨é‡Œé¢
[root@python tools]# mkdir -p /usr/local/python3.7.4
[root@python tools]# cd Python-3.7.4
[root@python Python-3.7.4]# ./configure --prefix=/usr/local/python3.7.4/
[root@python Python-3.7.4]# make && make install
5) å»ºç«‹è½¯è¿æ¥
[root@python Python-3.7.4]# ln -s /usr/local/python3.7.4/bin/python3.7 /usr/bin/python3
[root@python Python-3.7.4]# ln -s /usr/local/python3.7.4/bin/pip3.7 /usr/bin/pip3
 ln -s /usr/local/python3.7.4/bin/python3.7 /usr/local/bin/python 3
 ln -s /usr/local/python3.7.4/bin/pip3.7 /usr/local/bin/pip3
6) éªŒè¯å’Œæµ‹è¯•
[root@python Python-3.7.4]# python3.7.4
Python 3.7.4 (default, Jul 26 2019, 04:16:54) 
[GCC 4.8.5 20150623 (Red Hat 4.8.5-36)] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>>
```

```
 åŸå®¹å™¨è‡ªå¸¦è½¯è¿æ¥
 ln -s /usr/local/python3.7.0/bin/python3.7 /usr/bin/python
 ln -s /usr/local/python3.7.0/bin/pip3.7 /usr/bin/pip
 
 ln -s /usr/local/python3.7.0/bin/python3.7 /usr/local/bin/python 
 ln -s /usr/local/python3.7.0/bin/pip3.7 /usr/local/bin/pip
```



### Python3.8

**3.8.8 è¿˜æ²¡æµ‹è¯•è¿‡**

```
2) ä¸‹è½½python3å®‰è£…åŒ…
wget https://www.python.org/ftp/python/3.8.8/Python-3.8.8.tgz
3) è§£å‹
tar xvzf Python-3.8.8.tgz
4) åˆ›å»ºæ–‡ä»¶å¤¹æŠŠpython3å®‰è£…åœ¨é‡Œé¢
mkdir -p /usr/local/python3
cd Python-3.8.8
./configure --prefix=/usr/local/python3/
make && make install
5) å»ºç«‹è½¯è¿æ¥
[root@python Python-3.8.8]# ln -s /usr/local/python3/bin/python3.7 /usr/bin/python3
[root@python Python-3.8.8]# ln -s /usr/local/python3/bin/pip3.7 /usr/bin/pip3
6) éªŒè¯å’Œæµ‹è¯•
[root@python Python-3.8.8]# python3
Python 3.7.4 (default, Jul 26 2019, 04:16:54) 
[GCC 4.8.5 20150623 (Red Hat 4.8.5-36)] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>>
```









